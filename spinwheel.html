<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin to Win</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f9f9f9;
    }
    #wheel-container {
      margin-top: 20px;
    }
    #result {
      margin-top: 20px;
    }
    button {
      padding: 12px 25px;
      margin-top: 15px;
      font-size: 16px;
      cursor: pointer;
    }
    svg {
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

  <!-- Email Form -->
  <div id="email-form">
    <h2>Enter your email to play Spin to Win!</h2>
    <input type="email" id="userEmail" placeholder="Enter your email" required 
           style="padding:10px; width:250px;"/>
    <button onclick="startGame()">Submit</button>
  </div>

  <!-- Spin Wheel -->
  <div id="wheel-container" style="display:none;">
    <div style="position:relative; display:inline-block;">
      <svg id="wheel" xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400"></svg>
      <!-- Pointer -->
      <div style="position:absolute; top:-10px; left:50%; transform:translateX(-50%);">
        <svg width="40" height="40">
          <polygon points="20,0 30,20 10,20" style="fill:red;"></polygon>
        </svg>
      </div>
    </div>
    <br>
    <button id="spinBtn" onclick="spinWheel()">Spin the Wheel!</button>
  </div>

  <!-- Result -->
  <div id="result" style="display:none;">
    <h2 id="resultText"></h2>
    <button onclick="window.location.href='https://www.innotechnutrition.com/our-products'">
      Shop Now
    </button>
  </div>

<script>
const prizes = [
  {label: "5% OFF", code: "CHFA5", weight: 40},
  {label: "10% OFF", code: "CHFA10", weight: 25},
  {label: "15% OFF", code: "CHFA15", weight: 15},
  {label: "20% OFF", code: "CHFA20", weight: 10},
  {label: "30% OFF", code: "CHFA30", weight: 6},
  {label: "50% OFF", code: "CHFA50", weight: 3},
  {label: "75% OFF", code: "CHFA75", weight: 1}
];
const colors = ["#000000", "#d3d3d3"]; // black & gray
const svg = document.getElementById("wheel");
const radius = 200;
const center = 200;
let currentRotation = 0;

function drawWheel() {
  svg.innerHTML = "";
  let anglePerSlice = 360 / prizes.length;

  for (let i = 0; i < prizes.length; i++) {
    let startAngle = i * anglePerSlice;
    let endAngle = startAngle + anglePerSlice;
    let largeArc = endAngle - startAngle > 180 ? 1 : 0;

    // Convert polar to cartesian
    let x1 = center + radius * Math.cos(Math.PI * startAngle / 180);
    let y1 = center + radius * Math.sin(Math.PI * startAngle / 180);
    let x2 = center + radius * Math.cos(Math.PI * endAngle / 180);
    let y2 = center + radius * Math.sin(Math.PI * endAngle / 180);

    // Slice path
    let pathData = `
      M ${center} ${center}
      L ${x1} ${y1}
      A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
      Z
    `;

    // Slice element
    let path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", pathData);
    path.setAttribute("fill", colors[i % 2]);
    path.setAttribute("stroke", "#ffffff");   // outline color (white)
    path.setAttribute("stroke-width", "2");   // thickness of the outline
    svg.appendChild(path);

    // Label
    let midAngle = startAngle + anglePerSlice / 2;
    let lx = center + (radius - 50) * Math.cos(Math.PI * midAngle / 180);
    let ly = center + (radius - 50) * Math.sin(Math.PI * midAngle / 180);

    let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("x", lx);
    text.setAttribute("y", ly);
    text.setAttribute("fill", "#fff");
    text.setAttribute("font-size", "16");
    text.setAttribute("font-weight", "bold");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("alignment-baseline", "middle");
    text.textContent = prizes[i].label;
    svg.appendChild(text);
  }
}
drawWheel();

function pickPrize() {
  let totalWeight = prizes.reduce((a, p) => a + p.weight, 0);
  let rnd = Math.random() * totalWeight;
  let sum = 0;
  for (let p of prizes) {
    sum += p.weight;
    if (rnd <= sum) return p;
  }
  return prizes[0];
}

let spinning = false;
function spinWheel() {
  if (spinning) return;
  spinning = true;

  const prize = pickPrize();
  const prizeIndex = prizes.indexOf(prize);
  const sliceAngle = 360 / prizes.length;
  const targetAngle = 360 - (prizeIndex * sliceAngle + sliceAngle / 2);

  const spins = 5;
  const finalAngle = spins * 360 + targetAngle;
  let duration = 4000;
  let start = null;

  function animate(timestamp) {
    if (!start) start = timestamp;
    let progress = (timestamp - start) / duration;
    if (progress > 1) progress = 1;

    let eased = 1 - Math.pow(1 - progress, 3);
    currentRotation = eased * finalAngle;

    svg.style.transform = `rotate(${currentRotation}deg)`;

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      showResult(prize);
    }
  }
  requestAnimationFrame(animate);
}

function showResult(prize) {
  document.getElementById("wheel-container").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("resultText").innerHTML =
    `ðŸŽ‰ Congrats! You won <b>${prize.label}</b><br>Your code: <b>${prize.code}</b>`;
}

function startGame() {
  const email = document.getElementById("userEmail").value;
  if (!email) {
    alert("Please enter a valid email.");
    return;
  }
  document.getElementById("email-form").style.display = "none";
  document.getElementById("wheel-container").style.display = "block";
  drawWheel();
}
</script>
</body>
</html>
